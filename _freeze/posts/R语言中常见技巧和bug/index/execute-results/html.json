{
  "hash": "09062e66f65f66859ef47a02f76378a3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R 语言中常见bug 及解决方案\"\nauthor: \"LogitLegendary\"\ndate: \"2025-03-10\"\ncategories: [code] \nexecute:\n  eval: false\n---\n\n\n\n![](bug.png)\n\n\n## 1 循环画图所有图一样\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_list <- list()\ncolors <- c(rep(c(\"#990000\",\"black\",\"black\",\"black\"),4))\nfor (k in 1:dim(MC2)[2]) {\n  plot_list[[k]] <- ggplot(data = MC2) +\n    geom_line(aes(x = c(1:dim(MC2)[1]), y = !!sym(names(MC2)[k])),\n              color =colors[k]) +\n    theme_bw(base_family = \"Times\")+\n    xlab(\"\")+ylab(\"\")+\n    ggtitle(paste0(names(MC2)[k]))+\n    theme(plot.title = element_text(hjust = 0.5),  # Center the title\n          plot.margin = margin(t = 20)) \n}\ngrid_plot <-do.call(grid.arrange, c(plot_list, ncol=4, nrow=4))\n```\n:::\n\n\n注意：这里的y如果写成\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny=MC2[,k]\n```\n:::\n\n\n就会发生这个问题！\n\n## 2 ggplot作图不显示中文\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_bw(base_family = \"STKaiti\")\n\n或者\n\nlibrary(showtext)；showtext_auto()\n```\n:::\n\n\n在主题里设置字体，具体可用字体可搜索\n\n## 3 四舍五入保留两位小数，末尾为0也显示\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsprintf(\"%.2f\",round(Estimate, 2))\n```\n:::\n\n\nEstimate换成具体数值\n\n## 4 数据探索\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummmary() #所有变量进行描述\npairs() #所有变量两两散点图\n```\n:::\n\n\n\n## 5 多重线性回归教程\n[多重线性回归教程](https://www.library.virginia.edu/data/articles/getting-started-with-multivariate-multiple-regression)\n\n## 6 查看描述性分析的一个简单写法\n> ftable(xtabs(~var3+var1+var2,data = dat))\n> var1 代表行 var2代表列 var3分层\n\n\n## 7 误差棒\n[误差棒](https://www.jianshu.com/p/eee174707906)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat<- read_excel('dat.xlsx') %>% \n  mutate(BMI = 体重/(身高*0.01)^2,\n         组别 = ifelse(组别==0,'实验组','对照组')) %>% \n  dplyr::select(c(1,29:34))\n\ndf <- dat[,c(1,6:7)]\n\n\ndf <- pivot_longer(df, cols = c(2:3), names_to = \"condition\", values_to = \"value\") \ndf$condition <- factor(df$condition)\ndf$组别 <- factor(df$组别)\ndata_summary <- function(data, varname, groupnames){\n  require(plyr)\n  summary_func <- function(x, col){\n    c(mean = mean(x[[col]], na.rm=TRUE),\n      sd = sd(x[[col]], na.rm=TRUE))\n  }\n  data_sum<-ddply(data, groupnames, .fun=summary_func,\n                  varname)\n  #data_sum <- rename(data_sum, c(\"mean\" = varname))\n  return(data_sum)\n}\ndf2 <- data_summary(df, varname=\"value\", \n                    groupnames=c(\"组别\", \"condition\"))\nnames(df2)[c(2,3)] <-  c('阶段',\"value\")\ndf2$阶段 <- ifelse(df2$阶段=='抑郁','治疗前','治疗后')\n\nggplot(df2, aes(x=组别, y=value, fill=阶段)) + \n  geom_bar(stat=\"identity\", color=\"black\", \n           position=position_dodge()) +\n  geom_errorbar(aes(ymin=value-sd, ymax=value+sd), width=.2,\n                position=position_dodge(.9)) +\n  theme_minimal(base_family = \"Times\") +  \n  theme(panel.grid = element_blank(),\n        panel.border = element_blank(),\n        panel.background = element_rect(fill = NA),  \n        plot.background = element_rect(fill = NA,colour = NA),\n        plot.title = element_text(hjust = 0.5),\n        axis.text.y = element_text(face = \"bold\")) +  \n  labs(x = NULL, y = '均值',title = \"两组抑郁评分变化\")+\n  scale_fill_manual(values=c('#999999','#CCCCCC'))\n```\n:::\n\n\n\n\n## 8 长数据转化\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\n\n# 创建一个宽格式数据框\nwide_data <- data.frame(\n  id = 1:3,\n  var1_1 = c(1, 2, 3),\n  var1_2 = c(4, 5, 6),\n  var2_1 = c(7, 8, 9),\n  var2_2 = c(10, 11, 12)\n)\n\n# 使用pivot_longer函数将数据转换为长格式\nlong_data <- pivot_longer(wide_data, cols = starts_with(\"var\"), \n                          names_to = \"variable\", values_to = \"value\")\n\n# 查看转换后的长格式数据\nprint(long_data)\n```\n:::\n\n\n\n## 9 R代码加密\n![[代码加密测试.zip]]\n\n可参考：\n<[(3 封私信 / 44 条消息) R语言用怎么实现，可以让别人用一个函数，但是不能看底码？ - 知乎](https://www.zhihu.com/question/442134287)>\n\n<[source code protection - Encrypting R script under MS-Windows - Stack Overflow](https://stackoverflow.com/questions/4707276/encrypting-r-script-under-ms-windows/6946366#6946366)>\n\n## 10 ggplot 拼图技巧\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork) \n(p1 + p2 + p3 + p4) + \n  plot_annotation(\n    tag_levels = 'A'  # 设置标签为A, B, C, D\n  )\n```\n:::\n\n\n\n## 11 quarto编译beamer中文不显示\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle: 贝叶斯ppt\nauthor: 何从源\ndate: now\ndate-modified: now\nformat: beamer\noutput:\n  beamer_presentation:\n    latex_engine: xelatex  \nmainfont: \"Times New Roman\"  \nCJKmainfont: \"SimSun\"  \nfontsize: 10pt \n```\n:::\n\n\n\n## 12 GitHub上下载R包本地安装\n\n\n::: {.cell}\n\n```{.r .cell-code}\n> library(devtools)\n载入需要的程序包：usethis\n> devtools::install_local(\"D:/Download/sl3-master.zip\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}